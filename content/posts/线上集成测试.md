ç‚¹å‡»è¿”å›[ğŸ”—æˆ‘çš„åšå®¢æ–‡ç« ç›®å½•](https://2549141519.github.io/#/toc)
* ç›®å½•
{:toc}
<div onclick="window.scrollTo({top:0,behavior:'smooth'});" style="background-color:white;position:fixed;bottom:20px;right:40px;padding:10px 10px 5px 10px;cursor:pointer;z-index:10;border-radius:13%;box-shadow:0.5px 3px 7px rgba(0,0,0,0.3);"><img src="https://2549141519.github.io/blogImg/backTop.png" alt="TOP" style="background-color:white;width:30px;"></div>

# 1. GitHub Actionsçš„å·¥ä½œæµæ–‡ä»¶
.github/workflows æ–‡ä»¶å¤¹ä¸­çš„æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯ä¸€ä¸ªå·¥ä½œæµï¼ˆworkflowï¼‰ï¼Œé€šå¸¸ä»¥.ymlæˆ–.yamlç»“å°¾ã€‚  
æ¯ä¸ªå·¥ä½œæµæ–‡ä»¶å®šä¹‰äº†ä¸€ç»„è‡ªåŠ¨åŒ–ä»»åŠ¡ï¼Œè¿™äº›ä»»åŠ¡ä¼šåœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶ï¼ˆå¦‚ä»£ç æ¨é€ã€PRåˆ›å»ºã€è®¡åˆ’ä»»åŠ¡ç­‰ï¼‰è§¦å‘æ‰§è¡Œã€‚  
å·¥ä½œæµçš„ç»„æˆï¼š  
>
name: å·¥ä½œæµçš„åç§°ï¼Œç”¨äºæ ‡è¯†è¿™ä¸ªå·¥ä½œæµã€‚  
on: è§¦å‘å·¥ä½œæµçš„äº‹ä»¶ï¼ˆå¦‚pushã€pull_requestã€scheduleç­‰ï¼‰ã€‚  
jobs: ä¸€ç»„ä»»åŠ¡ï¼Œæ¯ä¸ªä»»åŠ¡å¯ä»¥åœ¨ä¸åŒçš„è™šæ‹Ÿæœºç¯å¢ƒä¸­è¿è¡Œã€‚ä»»åŠ¡å¯ä»¥åŒ…å«å¤šä¸ªæ­¥éª¤ï¼ˆstepsï¼‰ï¼Œæ¯ä¸ªæ­¥éª¤æ˜¯ä¸€ä¸ªå…·ä½“çš„Shellå‘½ä»¤æˆ–GitHub Actionã€‚  
steps: æ¯ä¸ªjobä¸‹çš„å…·ä½“æ­¥éª¤ï¼Œç”¨äºæ‰§è¡Œè„šæœ¬ã€è¿è¡Œå‘½ä»¤ã€è°ƒç”¨å¤–éƒ¨çš„GitHub Actionç­‰ã€‚  

# 2. workflowsé›†æˆæµ‹è¯•å®ç°
è¦æ±‚é›†æˆæµ‹è¯•èƒ½æµ‹è¯•é¡¹ç›®æ˜¯å¦æˆåŠŸç¼–è¯‘ã€‚  
åœ¨3TSä¸­ï¼Œæœ‰ä¸¤ç§ç¼–è¯‘æ–¹å¼ï¼š
>
1. ç›´æ¥ç¼–è¯‘å®‰è£…ï¼Œåœ¨`3TS/src/dbtest`ç›®å½•ä¸‹æ‰§è¡Œ  
```cmake -S ./```  
```make```  
2. ä½¿ç”¨dockerç¼–è¯‘ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤å®‰è£…dockerï¼ˆå¦‚æœè¿˜æœªå®‰è£…dockerï¼‰  
```curl -s https://get.docker.com/ | sh```  
è·å–é•œåƒ  
```docker pull registry.cn-hangzhou.aliyuncs.com/open_projects/3ts_coo:1.0```  
æŸ¥çœ‹é•œåƒIDï¼Œå¹¶æ ¹æ®é•œåƒIDç”Ÿæˆå®¹å™¨  
```docker images```  
```docker run -it [image_id] /bin/bash```  
æŸ¥çœ‹æ‰€æœ‰å®¹å™¨ï¼Œè¿›å…¥å®¹å™¨  
```docker ps -a```  
```docker exec -it [container_id] /bin/bash```  

## 2.1 é›†æˆæµ‹è¯•å®ç°
åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œè¿›å…¥`.github/workflows`æ–‡ä»¶å¤¹ï¼Œæ–°å»º`ci.yml`æ–‡ä»¶ï¼Œæ·»åŠ å¦‚ä¸‹å†…å®¹ï¼š  
```
name: 3TS CI

on:
  push:
    branches:
      - coo-consistency-check
  pull_request:
    branches:
      - coo-consistency-check

jobs:
  build_and_test:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v2

    # è®¾ç½®æ„å»ºç¯å¢ƒå’Œå®‰è£…ä¾èµ–é¡¹
    - name: Set up build environment
      run: |
        echo "Setting up build environment..."
        sudo apt-get update && sudo apt-get install -y cmake make g++ libgflags-dev unixodbc unixodbc-dev odbcinst odbcinst1debian2
        echo "Build environment setup complete."

    # å®‰è£… Dockerï¼Œå¦‚æœå°šæœªå®‰è£…
    - name: Install Docker
      run: |
        echo "Installing Docker..."
        curl -s https://get.docker.com/ | sh
        echo "Docker installed successfully."

    # æ‹‰å– Docker é•œåƒ
    - name: Pull Docker image
      run: docker pull registry.cn-hangzhou.aliyuncs.com/open_projects/3ts_coo:1.0

    # åˆ—å‡º Docker é•œåƒ
    - name: List Docker images
      run: docker images

    # è¿è¡Œ Docker å®¹å™¨ï¼Œå¹¶æŒ‚è½½é¡¹ç›®ç›®å½•
    - name: Run Docker container with volume
      run: |
        IMAGE_ID=$(docker images -q registry.cn-hangzhou.aliyuncs.com/open_projects/3ts_coo:1.0)
        docker run -d --name 3ts_container -v ${{ github.workspace }}:/src $IMAGE_ID tail -f /dev/null

    # åœ¨ Docker å®¹å™¨ä¸­ç¼–è¯‘
    - name: Compile inside Docker
      run: |
        echo "Compiling in Docker container..."
        docker exec -i 3ts_container bash -c "cd /src/src/dbtest && cmake -S ./ && make"

    # æ¸…ç† Docker å®¹å™¨
    - name: Clean up Docker container
      if: always()
      run: docker rm -f 3ts_container

    # åœ¨é Docker ç¯å¢ƒç¼–è¯‘
    - name: Compile without Docker
      run: |
        echo "Compiling using CMake..."
        cd src/dbtest
        sudo rm -rf CMakeCache.txt CMakeFiles  # æ¸…é™¤ç¼“å­˜æ–‡ä»¶
        cmake -S ./ || cmake -DCMAKE_PREFIX_PATH=/usr/ -S ./
        make
        echo "Compilation finished."

```  
æäº¤ä»£ç åˆ°`coo-consistency-check`åˆ†æ”¯ï¼ŒGitHub Actionså°±ä¼šè‡ªåŠ¨è§¦å‘å·¥ä½œæµï¼Œå¹¶æ‰§è¡Œæµ‹è¯•ã€‚ç”³è¯·pull requestï¼Œå®¡æ ¸é€šè¿‡ä¹Ÿå¯ä»¥è§¦å‘å·¥ä½œæµã€‚  
æµ‹è¯•é€šè¿‡ï¼Œè¯´æ˜é¡¹ç›®å¯ä»¥æˆåŠŸç¼–è¯‘ã€‚  

# 3. é›†æˆæµ‹è¯•ç»“æœ
ç¼–è¯‘æˆåŠŸçš„æµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š  
![Alt text](../blogImg/é›†æˆæµ‹è¯•1.PNG)  

æ­¤æ—¶è‹¥ä¿®æ”¹ä»£ç ä½¿ç¼–è¯‘ä¸é€šè¿‡ï¼Œæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼š  
![Alt text](../blogImg/é›†æˆæµ‹è¯•2.PNG)  