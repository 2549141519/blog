<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Wei Haoyu</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="ç‚¹å‡»è¿”å›ğŸ”—æˆ‘çš„åšå®¢æ–‡ç« ç›®å½•

ç›®å½•
{:toc}


paper link
1.ä»‹ç»
MapReduce æ˜¯ä¸€ç§ç”¨äºå¤„ç†å’Œç”Ÿæˆå¤§è§„æ¨¡æ•°æ®é›†çš„ç¼–ç¨‹æ¨¡å‹ã€‚å®ƒå°†æ•°æ®å¤„ç†åˆ†ä¸ºä¸¤ä¸ªä¸»è¦é˜¶æ®µï¼šMap å’Œ Reduceï¼Œä»è€Œå®ç°å¯¹å¤§æ•°æ®çš„å¹¶è¡Œè®¡ç®—å’Œåˆ†å¸ƒå¼å¤„ç†ã€‚MapReduceçš„è®¾è®¡ç›®æ ‡æ˜¯èƒ½å¤Ÿåœ¨è®¡ç®—æœºé›†ç¾¤ä¸Šé«˜æ•ˆå¤„ç†TBçº§ç”šè‡³PBçº§çš„æ•°æ®é›†ã€‚
2.ç¼–ç¨‹æ¨¡å‹
ä¾‹å¦‚å¤§å‹æ–‡æ¡£é›†åˆä¸­æ¯ä¸ªå•è¯å‡ºç°æ¬¡æ•°çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨MapReduceå¤„ç†ï¼Œä¸‹æ–‡å°†é»˜è®¤å¤„ç†è¯¥é—®é¢˜ã€‚
2.1Example
ä¼ªä»£ç ï¼š

map(String key, String value):
// key: document name
// value: document contents
for each word w in value:
EmitIntermediate(w, &ldquo;1&rdquo;);
reduce(String key, Iterator values):
// key: a word
// values: a list of counts
int result = 0;
for each v in values:
result &#43;= ParseInt(v);
Emit(AsString(result));
mapå‡½æ•°å‘å‡ºæ¯ä¸ªå•è¯åŠ ä¸Šä¸€ä¸ªç›¸å…³çš„å‡ºç°æ¬¡æ•°è®¡æ•°(åœ¨è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ä¸­åªæœ‰&rsquo; 1 &lsquo;)ã€‚reduceå‡½æ•°å°†é’ˆå¯¹ç‰¹å®šå•è¯å‘å‡ºçš„æ‰€æœ‰è®¡æ•°æ±‚å’Œã€‚
mapTaskå‡½æ•°å…·ä½“å®ç°ï¼š">
    <meta name="generator" content="Hugo 0.145.0">
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >




    


    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/posts/mapreduce/">
    

    <meta property="og:url" content="http://localhost:1313/posts/mapreduce/">
  <meta property="og:site_name" content="Wei Haoyu">
  <meta property="og:title" content="Wei Haoyu">
  <meta property="og:description" content="ç‚¹å‡»è¿”å›ğŸ”—æˆ‘çš„åšå®¢æ–‡ç« ç›®å½•
ç›®å½• {:toc} paper link
1.ä»‹ç» MapReduce æ˜¯ä¸€ç§ç”¨äºå¤„ç†å’Œç”Ÿæˆå¤§è§„æ¨¡æ•°æ®é›†çš„ç¼–ç¨‹æ¨¡å‹ã€‚å®ƒå°†æ•°æ®å¤„ç†åˆ†ä¸ºä¸¤ä¸ªä¸»è¦é˜¶æ®µï¼šMap å’Œ Reduceï¼Œä»è€Œå®ç°å¯¹å¤§æ•°æ®çš„å¹¶è¡Œè®¡ç®—å’Œåˆ†å¸ƒå¼å¤„ç†ã€‚MapReduceçš„è®¾è®¡ç›®æ ‡æ˜¯èƒ½å¤Ÿåœ¨è®¡ç®—æœºé›†ç¾¤ä¸Šé«˜æ•ˆå¤„ç†TBçº§ç”šè‡³PBçº§çš„æ•°æ®é›†ã€‚
2.ç¼–ç¨‹æ¨¡å‹ ä¾‹å¦‚å¤§å‹æ–‡æ¡£é›†åˆä¸­æ¯ä¸ªå•è¯å‡ºç°æ¬¡æ•°çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨MapReduceå¤„ç†ï¼Œä¸‹æ–‡å°†é»˜è®¤å¤„ç†è¯¥é—®é¢˜ã€‚
2.1Example ä¼ªä»£ç ï¼š
map(String key, String value):
// key: document name
// value: document contents
for each word w in value:
EmitIntermediate(w, â€œ1â€);
reduce(String key, Iterator values):
// key: a word
// values: a list of counts
int result = 0;
for each v in values:
result &#43;= ParseInt(v);
Emit(AsString(result));
mapå‡½æ•°å‘å‡ºæ¯ä¸ªå•è¯åŠ ä¸Šä¸€ä¸ªç›¸å…³çš„å‡ºç°æ¬¡æ•°è®¡æ•°(åœ¨è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ä¸­åªæœ‰â€™ 1 â€˜)ã€‚reduceå‡½æ•°å°†é’ˆå¯¹ç‰¹å®šå•è¯å‘å‡ºçš„æ‰€æœ‰è®¡æ•°æ±‚å’Œã€‚ mapTaskå‡½æ•°å…·ä½“å®ç°ï¼š">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">

  <meta itemprop="name" content="Wei Haoyu">
  <meta itemprop="description" content="ç‚¹å‡»è¿”å›ğŸ”—æˆ‘çš„åšå®¢æ–‡ç« ç›®å½•
ç›®å½• {:toc} paper link
1.ä»‹ç» MapReduce æ˜¯ä¸€ç§ç”¨äºå¤„ç†å’Œç”Ÿæˆå¤§è§„æ¨¡æ•°æ®é›†çš„ç¼–ç¨‹æ¨¡å‹ã€‚å®ƒå°†æ•°æ®å¤„ç†åˆ†ä¸ºä¸¤ä¸ªä¸»è¦é˜¶æ®µï¼šMap å’Œ Reduceï¼Œä»è€Œå®ç°å¯¹å¤§æ•°æ®çš„å¹¶è¡Œè®¡ç®—å’Œåˆ†å¸ƒå¼å¤„ç†ã€‚MapReduceçš„è®¾è®¡ç›®æ ‡æ˜¯èƒ½å¤Ÿåœ¨è®¡ç®—æœºé›†ç¾¤ä¸Šé«˜æ•ˆå¤„ç†TBçº§ç”šè‡³PBçº§çš„æ•°æ®é›†ã€‚
2.ç¼–ç¨‹æ¨¡å‹ ä¾‹å¦‚å¤§å‹æ–‡æ¡£é›†åˆä¸­æ¯ä¸ªå•è¯å‡ºç°æ¬¡æ•°çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨MapReduceå¤„ç†ï¼Œä¸‹æ–‡å°†é»˜è®¤å¤„ç†è¯¥é—®é¢˜ã€‚
2.1Example ä¼ªä»£ç ï¼š
map(String key, String value):
// key: document name
// value: document contents
for each word w in value:
EmitIntermediate(w, â€œ1â€);
reduce(String key, Iterator values):
// key: a word
// values: a list of counts
int result = 0;
for each v in values:
result &#43;= ParseInt(v);
Emit(AsString(result));
mapå‡½æ•°å‘å‡ºæ¯ä¸ªå•è¯åŠ ä¸Šä¸€ä¸ªç›¸å…³çš„å‡ºç°æ¬¡æ•°è®¡æ•°(åœ¨è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ä¸­åªæœ‰â€™ 1 â€˜)ã€‚reduceå‡½æ•°å°†é’ˆå¯¹ç‰¹å®šå•è¯å‘å‡ºçš„æ‰€æœ‰è®¡æ•°æ±‚å’Œã€‚ mapTaskå‡½æ•°å…·ä½“å®ç°ï¼š">
  <meta itemprop="wordCount" content="755">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Wei Haoyu">
  <meta name="twitter:description" content="ç‚¹å‡»è¿”å›ğŸ”—æˆ‘çš„åšå®¢æ–‡ç« ç›®å½•
ç›®å½• {:toc} paper link
1.ä»‹ç» MapReduce æ˜¯ä¸€ç§ç”¨äºå¤„ç†å’Œç”Ÿæˆå¤§è§„æ¨¡æ•°æ®é›†çš„ç¼–ç¨‹æ¨¡å‹ã€‚å®ƒå°†æ•°æ®å¤„ç†åˆ†ä¸ºä¸¤ä¸ªä¸»è¦é˜¶æ®µï¼šMap å’Œ Reduceï¼Œä»è€Œå®ç°å¯¹å¤§æ•°æ®çš„å¹¶è¡Œè®¡ç®—å’Œåˆ†å¸ƒå¼å¤„ç†ã€‚MapReduceçš„è®¾è®¡ç›®æ ‡æ˜¯èƒ½å¤Ÿåœ¨è®¡ç®—æœºé›†ç¾¤ä¸Šé«˜æ•ˆå¤„ç†TBçº§ç”šè‡³PBçº§çš„æ•°æ®é›†ã€‚
2.ç¼–ç¨‹æ¨¡å‹ ä¾‹å¦‚å¤§å‹æ–‡æ¡£é›†åˆä¸­æ¯ä¸ªå•è¯å‡ºç°æ¬¡æ•°çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨MapReduceå¤„ç†ï¼Œä¸‹æ–‡å°†é»˜è®¤å¤„ç†è¯¥é—®é¢˜ã€‚
2.1Example ä¼ªä»£ç ï¼š
map(String key, String value):
// key: document name
// value: document contents
for each word w in value:
EmitIntermediate(w, â€œ1â€);
reduce(String key, Iterator values):
// key: a word
// values: a list of counts
int result = 0;
for each v in values:
result &#43;= ParseInt(v);
Emit(AsString(result));
mapå‡½æ•°å‘å‡ºæ¯ä¸ªå•è¯åŠ ä¸Šä¸€ä¸ªç›¸å…³çš„å‡ºç°æ¬¡æ•°è®¡æ•°(åœ¨è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ä¸­åªæœ‰â€™ 1 â€˜)ã€‚reduceå‡½æ•°å°†é’ˆå¯¹ç‰¹å®šå•è¯å‘å‡ºçš„æ‰€æœ‰è®¡æ•°æ±‚å’Œã€‚ mapTaskå‡½æ•°å…·ä½“å®ç°ï¼š">

	
  </head><body class="ma0 avenir bg-near-white development">

    
   
  

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l center items-center justify-between">
    <a href="/" class="f3 fw2 hover-white white-90 dib no-underline">
      
        Wei Haoyu
      
    </a>
    <div class="flex-l items-center">
      

      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

    </div>
  </header>



    <main class="pb7" role="main">
      
  
  
  <article class="flex-l mw8 center ph3 flex-wrap justify-between">
    <header class="mt4 w-100">
      <aside class="instapaper_ignoref b helvetica tracked ttu">
          
        Posts
      </aside><div id="sharing" class="mt3 ananke-socials"></div>
<h1 class="f1 athelas mt3 mb1"></h1>
      
      
      

      
      
    </header>
    <div class="nested-copy-line-height lh-copy serif f4 nested-links mid-gray pr4-l w-two-thirds-l"><p>ç‚¹å‡»è¿”å›<a href="https://2549141519.github.io/#/toc">ğŸ”—æˆ‘çš„åšå®¢æ–‡ç« ç›®å½•</a></p>
<ul>
<li>ç›®å½•
{:toc}</li>
</ul>
<!-- raw HTML omitted -->
<p>paper <a href="https://static.googleusercontent.com/media/research.google.com/en//archive/mapreduce-osdi04.pdf">link</a></p>
<h1 id="1ä»‹ç»">1.ä»‹ç»</h1>
<p>MapReduce æ˜¯ä¸€ç§ç”¨äºå¤„ç†å’Œç”Ÿæˆå¤§è§„æ¨¡æ•°æ®é›†çš„ç¼–ç¨‹æ¨¡å‹ã€‚å®ƒå°†æ•°æ®å¤„ç†åˆ†ä¸ºä¸¤ä¸ªä¸»è¦é˜¶æ®µï¼šMap å’Œ Reduceï¼Œä»è€Œå®ç°å¯¹å¤§æ•°æ®çš„å¹¶è¡Œè®¡ç®—å’Œåˆ†å¸ƒå¼å¤„ç†ã€‚MapReduceçš„è®¾è®¡ç›®æ ‡æ˜¯èƒ½å¤Ÿåœ¨è®¡ç®—æœºé›†ç¾¤ä¸Šé«˜æ•ˆå¤„ç†TBçº§ç”šè‡³PBçº§çš„æ•°æ®é›†ã€‚</p>
<h1 id="2ç¼–ç¨‹æ¨¡å‹">2.ç¼–ç¨‹æ¨¡å‹</h1>
<p>ä¾‹å¦‚å¤§å‹æ–‡æ¡£é›†åˆä¸­æ¯ä¸ªå•è¯å‡ºç°æ¬¡æ•°çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨MapReduceå¤„ç†ï¼Œä¸‹æ–‡å°†é»˜è®¤å¤„ç†è¯¥é—®é¢˜ã€‚</p>
<h2 id="21example">2.1Example</h2>
<p>ä¼ªä»£ç ï¼š</p>
<blockquote>
<p>map(String key, String value):<br>
// key: document name<br>
// value: document contents<br>
for each word w in value:<br>
EmitIntermediate(w, &ldquo;1&rdquo;);<br>
reduce(String key, Iterator values):<br>
// key: a word<br>
// values: a list of counts<br>
int result = 0;<br>
for each v in values:<br>
result += ParseInt(v);<br>
Emit(AsString(result));</p></blockquote>
<p>mapå‡½æ•°å‘å‡ºæ¯ä¸ªå•è¯åŠ ä¸Šä¸€ä¸ªç›¸å…³çš„å‡ºç°æ¬¡æ•°è®¡æ•°(åœ¨è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ä¸­åªæœ‰&rsquo; 1 &lsquo;)ã€‚reduceå‡½æ•°å°†é’ˆå¯¹ç‰¹å®šå•è¯å‘å‡ºçš„æ‰€æœ‰è®¡æ•°æ±‚å’Œã€‚
mapTaskå‡½æ•°å…·ä½“å®ç°ï¼š</p>
<blockquote>
<p>func mapTask(mapf func(string, string) []KeyValue, file string, mapID int, nReduce int) (map[string][]KeyValue, error) {<br>
// è¯»å–æ–‡ä»¶å†…å®¹<br>
content, err := os.ReadFile(file)<br>
if err != nil {<br>
return nil, fmt.Errorf(&ldquo;cannot read file %v: %v&rdquo;, file, err)<br>
}<br>
// è°ƒç”¨ç”¨æˆ·æä¾›çš„ map å‡½æ•°ç”Ÿæˆé”®å€¼å¯¹<br>
kvs := mapf(file, string(content))<br>
// åˆå§‹åŒ–ä¸­é—´æ•°æ®<br>
intermediateData := make(map[string][]KeyValue)<br>
// åˆå§‹åŒ–ä¸­é—´æ–‡ä»¶å’Œç¼–ç å™¨<br>
intermediateFiles := make([]*os.File, nReduce)<br>
encoders := make([]*json.Encoder, nReduce)<br>
for i := 0; i &lt; nReduce; i++ {<br>
intermediateFileName := fmt.Sprintf(&ldquo;mr-%d-%d&rdquo;, mapID, i)<br>
intermediateFile, err := os.Create(intermediateFileName)<br>
if err != nil {<br>
log.Printf(&ldquo;Worker: Cannot create intermediate file %s: %v&rdquo;, intermediateFileName, err)<br>
return nil, fmt.Errorf(&ldquo;cannot create intermediate file %s: %v&rdquo;, intermediateFileName, err)<br>
}<br>
defer intermediateFile.Close()<br>
intermediateFiles[i] = intermediateFile<br>
encoders[i] = json.NewEncoder(intermediateFile)<br>
}<br>
// å¯¹æ¯ä¸ªé”®å€¼å¯¹è¿›è¡Œå“ˆå¸Œï¼Œæ ¹æ®å“ˆå¸Œå€¼å†³å®šå†™å…¥å“ªä¸ªReduceä»»åŠ¡çš„ä¸­é—´æ–‡ä»¶<br>
for _, kv := range kvs {<br>
reduceTask := ihash(kv.Key) % nReduce<br>
if err := encoders[reduceTask].Encode(&amp;kv); err != nil {<br>
log.Printf(&ldquo;Worker: Cannot encode intermediate data for reduce task %d: %v&rdquo;, reduceTask, err)<br>
return nil, fmt.Errorf(&ldquo;cannot encode intermediate data for reduce task %d: %v&rdquo;, reduceTask, err)<br>
}<br>
intermediateData[fmt.Sprintf(&ldquo;mr-%d-%d&rdquo;, mapID, reduceTask)] = append(intermediateData[fmt.Sprintf(&ldquo;mr-%d-%d&rdquo;, mapID, reduceTask)], kv)<br>
}<br>
return intermediateData, nil<br>
}</p></blockquote>
<p>reduceTaskå‡½æ•°å…·ä½“å®ç°ï¼š</p>
<blockquote>
<p>func reduceTask(reducef func(string, []string) string, reduceID int, nMap int) error {<br>
intermediate := []KeyValue{}<br>
// è¯»å–æ‰€æœ‰ä¸­é—´æ–‡ä»¶å¹¶è§£æé”®å€¼å¯¹<br>
for i := 0; i &lt; nMap; i++ {<br>
intermediateFileName := fmt.Sprintf(&ldquo;mr-%d-%d&rdquo;, i, reduceID)<br>
file, err := os.Open(intermediateFileName)<br>
if err != nil {<br>
return fmt.Errorf(&ldquo;cannot open intermediate file %s: %v&rdquo;, intermediateFileName, err)<br>
}<br>
dec := json.NewDecoder(file)<br>
for {<br>
var kv KeyValue<br>
if err := dec.Decode(&amp;kv); err != nil {<br>
if err.Error() == &ldquo;EOF&rdquo; {<br>
break<br>
}<br>
return fmt.Errorf(&ldquo;error decoding intermediate file %s: %v&rdquo;, intermediateFileName, err)<br>
}<br>
intermediate = append(intermediate, kv)<br>
}<br>
defer file.Close() // ç¡®ä¿åœ¨æ¯æ¬¡è¯»å–æ–‡ä»¶åå…³é—­æ–‡ä»¶<br>
}<br>
// æŒ‰é”®æ’åº<br>
sort.Slice(intermediate, func(i, j int) bool {<br>
return intermediate[i].Key &lt; intermediate[j].Key<br>
})<br>
// åˆ›å»ºè¾“å‡ºæ–‡ä»¶<br>
outputFileName := fmt.Sprintf(&ldquo;mr-out-%d&rdquo;, reduceID)<br>
ofile, err := os.Create(outputFileName)<br>
if err != nil {<br>
return fmt.Errorf(&ldquo;cannot create output file %s: %v&rdquo;, outputFileName, err)<br>
}<br>
defer ofile.Close()<br>
// Reduceé˜¶æ®µï¼ŒæŒ‰é”®åˆå¹¶ç›¸åŒçš„é”®ï¼Œå¹¶è°ƒç”¨ç”¨æˆ·å®šä¹‰çš„Reduceå‡½æ•°<br>
i := 0<br>
for i &lt; len(intermediate) {<br>
j := i + 1<br>
// æ‰¾å‡ºæ‰€æœ‰å…·æœ‰ç›¸åŒé”®çš„å€¼<br>
for j &lt; len(intermediate) &amp;&amp; intermediate[j].Key == intermediate[i].Key {<br>
j++<br>
}<br>
values := []string{}<br>
for k := i; k &lt; j; k++ {<br>
values = append(values, intermediate[k].Value)<br>
}<br>
// è°ƒç”¨ç”¨æˆ·æä¾›çš„Reduceå‡½æ•°å¤„ç†å€¼<br>
output := reducef(intermediate[i].Key, values)<br>
// æŒ‰æŒ‡å®šæ ¼å¼è¾“å‡ºç»“æœ<br>
fmt.Fprintf(ofile, &ldquo;%v %v\n&rdquo;, intermediate[i].Key, output)<br>
i = j<br>
}<br>
return nil<br>
}</p></blockquote>
<h2 id="22æ‰§è¡Œæ¦‚è¿°">2.2æ‰§è¡Œæ¦‚è¿°</h2>
<p><img src="../blogImg/%E6%89%A7%E8%A1%8C%E6%A6%82%E8%BF%B0.PNG" alt="Alt text"></p>
<p>Mapé˜¶æ®µï¼šåœ¨Mapé˜¶æ®µï¼Œè¾“å…¥æ•°æ®è¢«åˆ†æˆå¤šä¸ªå°ç‰‡æ®µï¼ˆç§°ä¸ºåˆ†ç‰‡ï¼Œsplitï¼‰ï¼Œæ¯ä¸ªåˆ†ç‰‡éƒ½ä½œä¸ºä¸€ä¸ªé”®å€¼å¯¹ï¼ˆkey-value pairï¼‰ä¼ é€’ç»™Mapå‡½æ•°ã€‚Mapå‡½æ•°å¯¹è¾“å…¥çš„é”®å€¼å¯¹è¿›è¡Œå¤„ç†ï¼Œç„¶åç”Ÿæˆä¸€ç»„ä¸­é—´çš„é”®å€¼å¯¹ã€‚è¿™äº›ä¸­é—´é”®å€¼å¯¹é€šå¸¸ä¼šæŒ‰ç…§é”®è¿›è¡Œåˆ†ç»„ï¼Œä»¥ä¾¿åç»­çš„Reduceé˜¶æ®µè¿›è¡Œå¤„ç†ã€‚
ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç»Ÿè®¡ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ä¸­æ¯ä¸ªå•è¯å‡ºç°çš„æ¬¡æ•°ï¼ŒMapå‡½æ•°çš„è¾“å…¥æ˜¯æ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œï¼ˆä½œä¸ºvalueï¼‰ï¼Œæ¯ä¸€è¡Œè¢«åˆ†å‰²æˆå•è¯ï¼Œç„¶åMapå‡½æ•°è¾“å‡ºä¸€ä¸ªå•è¯å’Œè®¡æ•°å€¼ï¼ˆåˆå§‹ä¸º1ï¼‰çš„é”®å€¼å¯¹ã€‚</p>
<p>æœ‰ä¸€ä¸ªç‰¹æ®Šçš„masterå’Œå¤šä¸ªç”±masteråˆ†é…çš„workerã€‚
æœ‰Mä¸ªmapä»»åŠ¡å’ŒRä¸ªreduceä»»åŠ¡è¦åˆ†é…ã€‚masteré€‰æ‹©ç©ºé—²çš„workerï¼Œå¹¶ä¸ºæ¯ä¸ªworkeråˆ†é…ä¸€ä¸ªmapä»»åŠ¡æˆ–reduceä»»åŠ¡ã€‚</p>
<p>ä¸€ä¸ªè¢«åˆ†é…Mapä»»åŠ¡çš„workeréœ€è¦ä»åˆ‡ç‰‡ä¸­è¯»å–å†…å®¹ï¼Œä»ä¸­è§£æå‡ºkey/valueå¯¹åä¼ å…¥ç”¨æˆ·å®šä¹‰çš„mapæ–¹æ³•ï¼Œmapæ–¹æ³•äº§ç”Ÿçš„ä¸­é—´key/valueå¯¹æ”¾åœ¨å†…å­˜ç¼“å†²åŒºä¸­ã€‚</p>
<p>è¿™äº›key/valueå¯¹å‘¨æœŸæ€§çš„å†™å…¥ç£ç›˜ï¼Œå®ƒä»¬åœ¨ç£ç›˜çš„ä½ç½®è¢«ä¼ é€’ç»™masterï¼Œmasterå°†è¿™äº›æ•°æ®åˆ†é…ç»™æ‰§è¡Œreduceä»»åŠ¡çš„workerã€‚</p>
<p>å½“reduce workerè¯»å–äº†æ‰€æœ‰ä¸­é—´æ•°æ®åï¼Œå®ƒæŒ‰ä¸­é—´é”®å¯¹æ•°æ®è¿›è¡Œæ’åºï¼Œä»¥ä¾¿å°†æ‰€æœ‰å‡ºç°çš„ç›¸åŒé”®åˆ†ç»„åœ¨ä¸€èµ·ã€‚</p>
<p>reduce workeréå†æ‰€æœ‰çš„ä¸­é—´æ•°æ®ï¼Œå°†æ¯ä¸ªå”¯ä¸€çš„ä¸­é—´æ•°æ®ä¼ ç»™ç”¨æˆ·å®šä¹‰çš„reduceå‡½æ•°ã€‚</p>
<h2 id="23master-data-structures">2.3Master Data Structures</h2>
<p>Masterç»“æ„ä½“çš„å®šä¹‰ä¸¾ä¾‹ï¼š</p>
<blockquote>
<p>type Master struct {<br>
files            []string                      // è¾“å…¥æ–‡ä»¶åˆ—è¡¨<br>
nReduce          int                           // reduce ä»»åŠ¡æ•°é‡<br>
mapTasks         int                           // map ä»»åŠ¡æ•°é‡<br>
reduceTasks      int                           // reduce ä»»åŠ¡æ•°é‡<br>
taskStatus       map[int]string                // ä»»åŠ¡çŠ¶æ€<br>
taskMutex        sync.Mutex                    // äº’æ–¥é”<br>
done             bool                          // ä»»åŠ¡æ˜¯å¦å®Œæˆ<br>
intermediateData map[int]map[string][]KeyValue // ä¸­é—´æ•°æ®<br>
taskTimeout      map[int]time.Time             // ä»»åŠ¡è¶…æ—¶æ—¶é—´<br>
timeout          time.Duration                 // ä»»åŠ¡è¶…æ—¶æ—¶é—´é—´éš”<br>
}</p></blockquote>
<h2 id="24åˆ†é…ä»»åŠ¡">2.4åˆ†é…ä»»åŠ¡</h2>
<p>ä¸‹é¢æ˜¯åˆ†é…ä»»åŠ¡å‡½æ•°ï¼ˆGetTaskï¼‰ä¾‹å­ï¼š</p>
<blockquote>
<p>func (m *Master) GetTask(args *TaskRequest, reply *TaskReply) error {<br>
m.taskMutex.Lock()<br>
defer m.taskMutex.Unlock()<br>
// æ£€æŸ¥æ˜¯å¦æ‰€æœ‰ä»»åŠ¡éƒ½å·²å®Œæˆ<br>
if m.done {<br>
reply.TaskType = &quot;&quot; // æ˜¾å¼è®¾ç½®ä¸ºç©ºçš„ä»»åŠ¡ç±»å‹ä»¥è¡¨ç¤ºæ²¡æœ‰æ›´å¤šä»»åŠ¡<br>
return nil<br>
}<br>
now := time.Now()<br>
taskAssigned := false<br>
// é¦–å…ˆæ£€æŸ¥æ˜¯å¦æœ‰æ‰€æœ‰ Map ä»»åŠ¡å®Œæˆ<br>
allMapCompleted := true<br>
for i := 0; i &lt; m.mapTasks; i++ {<br>
status, ok := m.taskStatus[i]<br>
if !ok || status != &ldquo;completed&rdquo; {<br>
allMapCompleted = false<br>
break<br>
}<br>
}<br>
if !allMapCompleted {<br>
// åˆ†é… Map ä»»åŠ¡<br>
for i := 0; i &lt; m.mapTasks; i++ {<br>
status, ok := m.taskStatus[i]<br>
if (!ok || status == &ldquo;pending&rdquo;) || (status == &ldquo;in-progress&rdquo; &amp;&amp; now.Sub(m.taskTimeout[i]) &gt; m.timeout) {<br>
reply.TaskType = string(Map)<br>
reply.TaskID = i<br>
reply.NMap = len(m.files)<br>
reply.File = m.files[i]<br>
reply.NReduce = m.nReduce<br>
reply.Data = make(map[string][]KeyValue)<br>
m.taskStatus[i] = &ldquo;in-progress&rdquo;<br>
m.taskTimeout[i] = now<br>
taskAssigned = true<br>
break<br>
}<br>
}<br>
} else {<br>
// å¦‚æœæ‰€æœ‰ Map ä»»åŠ¡å®Œæˆï¼Œåˆ†é… Reduce ä»»åŠ¡<br>
for i := 0; i &lt; m.reduceTasks; i++ {<br>
status, ok := m.taskStatus[i+m.mapTasks]<br>
if (!ok || status == &ldquo;pending&rdquo;) || (status == &ldquo;in-progress&rdquo; &amp;&amp; now.Sub(m.taskTimeout[i+m.mapTasks]) &gt; m.timeout) {<br>
reply.TaskType = string(Reduce)<br>
reply.TaskID = i + m.mapTasks<br>
reply.NMap = len(m.files)<br>
reply.ReduceID = i<br>
reply.NReduce = m.nReduce<br>
reply.Data = make(map[string][]KeyValue)<br>
m.taskStatus[i+m.mapTasks] = &ldquo;in-progress&rdquo;<br>
m.taskTimeout[i+m.mapTasks] = now<br>
taskAssigned = true<br>
break<br>
}<br>
}<br>
}<br>
if taskAssigned {<br>
return nil<br>
}<br>
// å¦‚æœæ²¡æœ‰å¯åˆ†é…çš„ä»»åŠ¡ï¼Œæ£€æŸ¥æ‰€æœ‰ä»»åŠ¡æ˜¯å¦å®Œæˆ<br>
allCompleted := true<br>
for _, status := range m.taskStatus {<br>
if status != &ldquo;completed&rdquo; {<br>
allCompleted = false<br>
break<br>
}<br>
}<br>
if allCompleted {<br>
m.done = true<br>
reply.TaskType = &quot;&quot; // æ²¡æœ‰æ›´å¤šä»»åŠ¡æ—¶æ˜¾å¼è®¾ç½®ä¸ºç©º<br>
}<br>
return nil<br>
}</p></blockquote>
<h1 id="3é«˜å¯ç”¨">3.é«˜å¯ç”¨</h1>
<h2 id="31workerå®•æœº">3.1workerå®•æœº</h2>
<p>masterå®šæœŸpingæ¯ä¸ªworkerã€‚å¦‚æœåœ¨ä¸€å®šæ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ¥è‡ªworkerçš„å“åº”ï¼Œåˆ™masterå°†è¯¥workeræ ‡è®°ä¸ºå¤±è´¥ã€‚å·¥ä½œçº¿ç¨‹å®Œæˆçš„ä»»ä½•maptaskéƒ½è¢«é‡ç½®å›å…¶åˆå§‹ç©ºé—²çŠ¶æ€ï¼Œå› æ­¤å¯ä»¥åœ¨å…¶ä»–å·¥ä½œçº¿ç¨‹ä¸Šè°ƒåº¦ã€‚åœ¨å¤±è´¥çš„workerä¸Šæ­£åœ¨è¿›è¡Œçš„ä»»ä½•mapä»»åŠ¡æˆ–reducetaskä¹Ÿè¢«é‡ç½®ä¸ºç©ºé—²ï¼Œå¹¶æœ‰èµ„æ ¼é‡æ–°è°ƒåº¦ã€‚
å®Œæˆçš„mapä»»åŠ¡åœ¨å‘ç”Ÿæ•…éšœæ—¶é‡æ–°æ‰§è¡Œï¼Œå› ä¸ºå®ƒä»¬çš„è¾“å‡ºå­˜å‚¨åœ¨æ•…éšœæœºå™¨çš„æœ¬åœ°ç£ç›˜ä¸Šï¼Œå› æ­¤æ— æ³•è®¿é—®ã€‚
å®Œæˆçš„reduceä»»åŠ¡ä¸éœ€è¦é‡æ–°æ‰§è¡Œï¼Œå› ä¸ºå®ƒä»¬çš„è¾“å‡ºå­˜å‚¨åœ¨å…¨å±€æ–‡ä»¶ç³»ç»Ÿä¸­ã€‚å½“mapä»»åŠ¡é¦–å…ˆç”±worker Aæ‰§è¡Œï¼Œç„¶åç”±worker Bæ‰§è¡Œ(å› ä¸ºAå¤±è´¥)æ—¶ï¼Œmasterä¼šé€šçŸ¥æ‰§è¡Œreduceä»»åŠ¡çš„workeré‡æ‰§è¡Œã€‚ä»»ä½•å°šæœªä»worker Aè¯»å–æ•°æ®çš„reduceä»»åŠ¡éƒ½å°†ä»worker Bè¯»å–æ•°æ®ã€‚</p>
<h2 id="32masterå®•æœº">3.2masterå®•æœº</h2>
<p>masterå®šæœŸå°†å®ƒç»´æŠ¤çš„å…³é”®æ•°æ®ç»“æ„ï¼ˆå¦‚ä»»åŠ¡çŠ¶æ€ã€èµ„æºåˆ†é…ä¿¡æ¯ç­‰ï¼‰å†™å…¥æ£€æŸ¥ç‚¹ï¼ˆcheckpointï¼‰ã€‚å¦‚æœmasterå®•æœºäº†ï¼Œç³»ç»Ÿå¯ä»¥ä»æœ€åä¸€æ¬¡æ£€æŸ¥ç‚¹çš„çŠ¶æ€æ¢å¤ï¼Œè€Œä¸éœ€è¦ä»å¤´å¼€å§‹æ•´ä¸ªè®¡ç®—ã€‚
å¦‚æœmasterçš„ä»»åŠ¡å¤±è´¥ï¼ˆå³masterå®•æœºæˆ–å´©æºƒï¼‰ï¼Œå¯ä»¥ä»æœ€åä¸€æ¬¡æ£€æŸ¥ç‚¹çš„çŠ¶æ€é‡æ–°å¯åŠ¨ä¸€ä¸ªæ–°çš„masterå‰¯æœ¬ã€‚è¿™ä¸ªæ–°çš„masterå°†ä»ä¿å­˜çš„æ£€æŸ¥ç‚¹çŠ¶æ€ä¸­æ¢å¤ï¼Œç»§ç»­è¿›è¡ŒMapReduceè®¡ç®—ã€‚</p>
<ul class="pa0">
  
</ul>
<div class="mt6 instapaper_ignoref">
      
      
      </div>
    </div>

    <aside class="w-30-l mt6-l">




</aside>

  </article>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white white-70 dn dib-ns pv2 ph3 no-underline" href="http://localhost:1313/" >
    &copy;  Wei Haoyu 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
